<% if @user && @user.errors.any? %>
  <p class="errors">
    <%= @user.errors.full_messages.map{|m|m}.join("<br>").html_safe %>
  </p>
<% end %>


<h1>Fields</h1>

<p class="info">
  Before we can add your contacts, let us know what sort of info you want to collect.
</p>

<%= form_for current_user, url: fields_path do |f| %>
  <table id="fields">
    <thead>
      <th>Title</th>
      <th>Permalink</th>
      <th>Data Type</th>
      <th></th>
    </thead>
  
    <tbody>
    	<%= f.fields_for :fields do |builder| %>
        <%= render "edit_fields", f: builder %>
      <% end %>
    </tbody>
    
    <tfoot>
      <td><%= link_to_add_fields "Add Field", f, :fields %></td>
      <td></td>
      <td></td>
      <td></td>
    </tfoot>
  </table>
  
  <%= f.hidden_field :upload, value: true %>
  <%= f.hidden_field :step, value: 3 if current_user.step == 2 %>
  
  <%= f.submit "Save Fields and Continue to Upload File" %>

<% end %>

<ul>
  <% suggested_fields.each do |title, permalink, data_type| %>
    <% unless @fields.pluck(:permalink).include? permalink %>
      <li><%= link_to title, "#", class: "add_suggested_field", data: { title: title, data_type: data_type, permalink: permalink } %></li>
    <% end %>
  <% end %>
</ul>